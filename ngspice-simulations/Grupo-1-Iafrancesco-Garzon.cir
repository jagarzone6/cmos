** Amplificador operacional grupo XXX

* Fuentes de alimentación

vdd_1	vdd_1	0	dc	2.5
vss_1	vss_1	0	dc	-2.5
i1_1	vdd_1	vg8_1	dc 0.00023231999999999997

* Fuentes de señal - open loop
vip_1	vip_1	0	dc	0	ac	0.5	180
vin_1	vin_1	0	dc	0	ac	0.5

* Fuentes de corriente
m8_1 vg8_1 vg8_1 vss_1 vss_1 nmosg W=3.2e-06 L=1.6e-06
m5_1 vss_1 vg8_1 vs_1 vss_1 nmosg L=1.6U W=3.2U AS=14.72P AD=18.304P PS=12.32U PD=13.6U
m7_A_1 vo_1 vg8_1 vss_1 vss_1 nmosg L=1.6U W=4.8U AS=18.304P AD=28.48P PS=13.6U PD=17.467U
m7_B_1 vss_1 vg8_1 vo_1 vss_1 nmosg L=1.6U W=4.8U AS=28.48P AD=18.304P PS=17.467U PD=13.6U
m7_C_1 vss_1 vg8_1 vo_1 vss_1 nmosg L=1.6U W=4.8U AS=28.48P AD=18.304P PS=17.467U PD=13.6U
m7_D_1 vo_1 vg8_1 vss_1 vss_1 nmosg L=1.6U W=4.8U AS=18.304P AD=28.48P PS=13.6U PD=17.467U

* Par diferencial
m3_A_1 vdd_1 vg3_1 vg3_1 vdd_1 pmosg L=1.6U W=4.4U AS=22.773P AD=22.937P PS=19.2U PD=13.657U
m3_B_1 vg3_1 vg3_1 vdd_1 vdd_1 pmosg L=1.6U W=4.4U AS=22.937P AD=22.773P PS=13.657U PD=19.2U
m3_C_1 vdd_1 vg3_1 vg3_1 vdd_1 pmosg L=1.6U W=4.4U AS=22.773P AD=22.937P PS=19.2U PD=13.657U
m3_D_1 vg3_1 vg3_1 vdd_1 vdd_1 pmosg L=1.6U W=4.4U AS=22.937P AD=22.773P PS=13.657U PD=19.2U
m4_A_1 vod_1 vg3_1 vdd_1 vdd_1 pmosg L=1.6U W=4.4U AS=22.937P AD=23.947P PS=13.657U PD=19.733U
m4_B_1 vdd_1 vg3_1 vod_1 vdd_1 pmosg L=1.6U W=4.4U AS=23.947P AD=22.937P PS=19.733U PD=13.657U
m4_C_1 vod_1 vg3_1 vdd_1 vdd_1 pmosg L=1.6U W=4.4U AS=22.937P AD=23.947P PS=13.657U PD=19.733U
m4_D_1 vdd_1 vg3_1 vod_1 vdd_1 pmosg L=1.6U W=4.4U AS=23.947P AD=22.937P PS=19.733U PD=13.657U
m1_A_1 vs_1 vin_1 vg3_1 vss_1 nmosg L=1.6U W=4U AS=22.773P AD=14.72P PS=19.2U PD=12.32U
m1_B_1 vg3_1 vin_1 vs_1 vss_1 nmosg L=1.6U W=4U AS=14.72P AD=22.773P PS=12.32U PD=19.2U
m2_A_1 vod_1 vip_1 vs_1 vss_1 nmosg L=1.6U W=4U AS=14.72P AD=23.947P PS=12.32U PD=19.733U
m2_B_1 vs_1 vip_1 vod_1 vss_1 nmosg L=1.6U W=4U AS=23.947P AD=14.72P PS=19.733U PD=12.32U

* Etapa de salida
m6_1_1 vdd_1 vod_1 vo_1 vdd_1 pmosg L=1.6U W=8U AS=28.48P AD=22.937P PS=17.467U PD=13.657U
m6_2_1 vo_1 vod_1 vdd_1 vdd_1 pmosg L=1.6U W=8U AS=22.937P AD=28.48P PS=13.657U PD=17.467U
m6_3_1 vdd_1 vod_1 vo_1 vdd_1 pmosg L=1.6U W=8U AS=28.48P AD=22.937P PS=17.467U PD=13.657U
m6_4_1 vo_1 vod_1 vdd_1 vdd_1 pmosg L=1.6U W=8U AS=22.937P AD=28.48P PS=13.657U PD=17.467U
m6_5_1 vdd_1 vod_1 vo_1 vdd_1 pmosg L=1.6U W=8U AS=28.48P AD=22.937P PS=17.467U PD=13.657U
m6_6_1 vo_1 vod_1 vdd_1 vdd_1 pmosg L=1.6U W=8U AS=22.937P AD=28.48P PS=13.657U PD=17.467U
m6_7_1 vdd_1 vod_1 vo_1 vdd_1 pmosg L=1.6U W=8U AS=28.48P AD=22.937P PS=17.467U PD=13.657U
m6_8_1 vo_1 vod_1 vdd_1 vdd_1 pmosg L=1.6U W=8U AS=22.937P AD=28.48P PS=13.657U PD=17.467U
m6_9_1 vdd_1 vod_1 vo_1 vdd_1 pmosg L=1.6U W=8U AS=28.48P AD=22.937P PS=17.467U PD=13.657U
m6_10_1 vo_1 vod_1 vdd_1 vdd_1 pmosg L=1.6U W=8U AS=22.937P AD=28.48P PS=13.657U PD=17.467U
m6_11_1 vdd_1 vod_1 vo_1 vdd_1 pmosg L=1.6U W=8U AS=28.48P AD=22.937P PS=17.467U PD=13.657U
m6_12_1 vo_1 vod_1 vdd_1 vdd_1 pmosg L=1.6U W=8U AS=22.937P AD=28.48P PS=13.657U PD=17.467U
m6_13_1 vdd_1 vod_1 vo_1 vdd_1 pmosg L=1.6U W=8U AS=28.48P AD=22.937P PS=17.467U PD=13.657U
m6_14_1 vo_1 vod_1 vdd_1 vdd_1 pmosg L=1.6U W=8U AS=22.937P AD=28.48P PS=13.657U PD=17.467U
m6_15_1 vdd_1 vod_1 vo_1 vdd_1 pmosg L=1.6U W=8U AS=28.48P AD=22.937P PS=17.467U PD=13.657U
m6_16_1 vo_1 vod_1 vdd_1 vdd_1 pmosg L=1.6U W=8U AS=22.937P AD=28.48P PS=13.657U PD=17.467U
m6_17_1 vdd_1 vod_1 vo_1 vdd_1 pmosg L=1.6U W=8U AS=28.48P AD=22.937P PS=17.467U PD=13.657U
m6_18_1 vo_1 vod_1 vdd_1 vdd_1 pmosg L=1.6U W=8U AS=22.937P AD=28.48P PS=13.657U PD=17.467U
m6_19_1 vdd_1 vod_1 vo_1 vdd_1 pmosg L=1.6U W=8U AS=28.48P AD=22.937P PS=17.467U PD=13.657U
m6_20_1 vo_1 vod_1 vdd_1 vdd_1 pmosg L=1.6U W=8U AS=22.937P AD=28.48P PS=13.657U PD=17.467U

* condensadores
Cc_1 vod_1 vo_1 4.2239999999999995e-13
Cl_1 vo_1 0 10p




* modelos para tecnología 0.8u < L < 200u 10u < W < 10000u  Vdd=2.5V (Allen)
* lambda cambia de acuerdo con la longitud del canal
* nmOS: lambda=0.04 para L=1u y lambda=0.01 para L=2u
* pmOS: lambda=0.05 para L=1u y lambda=0.01 para L=2u

.model nmosg nmos level=2
+ vto = 0.7 kp = 110e-6 gamma = 0.4 phi = 0.7
+ tox = 14e-9 cj = 770e-6 cjsw = 380e-12 mj = 0.5 mjsw = 0.38
+ cgso = 220e-12 cgdo = 220e-12 cgbo = 700e-12
+ lambda = 0.04

.model pmosg pmos level=2
+ vto = -0.7 kp = 50e-6 gamma = 0.57 phi = 0.8
+ tox = 14e-9 cj = 560e-6 cjsw = 350e-12 mj = 0.5 mjsw = 0.35
+ cgso = 220e-12 cgdo = 220e-12 cgbo = 700e-12
+ lambda = 0.05

.control
set temp = 27
set tnom = 27
set color0 =white
set color1=black
op
show all

*Ganacia en AC barrido en frecuencia vout/vin AC
ac dec 10 1 10ghz
let av = v(vo_1)/v(vin_1)
*Ganancia en decibeles
plot db(av)
*Ganancia en magnitud V/V
*plot mag(av)
*phase plot
plot ph(av)*360/(2*pi)

*Phase margin
meas ac freqzerodbs when vdb(av)=0 fall=LAST
print freqzerodbs
meas ac pmb find vp(av) when vdb(av)=0
let phasemargin = 180+pmb*360/(2*pi)
print phasemargin

*Band width
meas ac Gain mAX vdb(av) from=1 to=10ghz
let gain3dbs = Gain-3
print gain3dbs
meas ac Bw when vdb(av)=gain3dbs fall=LAST

*Transitorio
tran .00001s .01s
*Potencia discipada en el circuito (vdd_1-vss_1)*Itotal
plot v(vdd_1,vss_1)*vss_1#branch
.endc
